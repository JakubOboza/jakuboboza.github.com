
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>No F*cking Idea</title>
  <meta name="author" content="Jakub Oboza">

  
  <meta name="description" content="JVM as a virtual machine is great. I&rsquo;m not in love with java as i think too many {} can kill anyone regardless of faith. It was really really &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://no-fucking-idea.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="No F*cking Idea" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17523816-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-0727620290960762",
            enable_page_level_ads: true
       });
  </script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">No F*cking Idea</a></h1>
  
    <h2>Common answer to everything</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:no-fucking-idea.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/link-lib">LIB!</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/25/java-dot-util-dot-concurrent-goodies/">java.util.concurrent Goodies</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-25T16:42:41+01:00" pubdate data-updated="true">Aug 25<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/08/25/java-dot-util-dot-concurrent-goodies/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2014/08/25/java-dot-util-dot-concurrent-goodies/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>JVM as a virtual machine is great. I&rsquo;m not in love with java as i think too many <code>{}</code> can kill anyone regardless of faith. It was really really long time since i wrote anything for the blog and today as it is &ldquo;summer bank holiday&rdquo; i decided to finally sit down and write few things that are interesting.</p>

<h1>java.util.concurrent</h1>

<p>Even if i will be talking about java.util.concurrent i will give few examples using Scala. I like Scala and i think it is much easier to understand and read than java. Simply less tokens. And less tokens mean more fun.</p>

<p>I don&rsquo;t know if explore how much nice things there is in JVM, one of thme is truffle (added in java 8 but i will not be talking about it.). One of the great things is called java.util.concurrent this set of tools/lib gives us  tools to work with concurrency.</p>

<p>In times of agents such a set of tools could feel a bit outdated but still they can gives us valuable lessons about concurrency and maybe be useful in present/future.</p>

<h1>Abstracts</h1>

<p>So as we all know java is full of design patterns and one of the first things you will not while looking into docs are abstract classes. This kinda gives us overview of what we can expect in the package. Just like a movie teaser but&hellip; boring :).
First thing we notice while looking at <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/package-summary.html">http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/package-summary.html</a> is probably <code>BlockingDeque</code> and <code>BlockingQueue</code>. And this is out first example.</p>

<h1>ArrayBlockingQueue</h1>

<p>If you ever worked with threads or any concurrent constructs you know how useful are channels/queues. First concrete class in the package is <code>ArrayBlockingQueue[T]</code> which lets us construct queues. For those who don&rsquo;t know what queue is, it is a FIFO construct, FIFO means First In, First Out. So elements that get in first will be picked up at the receiving end of queue before rest. It is like a queue for tickets before a big summer blockbuster release.</p>

<p>Let us try this ArrayBlockingQueue out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">java.util.concurrent._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">scala.util.control.Breaks._</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">Example</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">queue</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ArrayBlockingQueue</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="mi">100</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">val</span> <span class="n">producer1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="mi">1000</span><span class="o">).</span><span class="n">map</span><span class="o">(</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">while</span><span class="o">(!</span><span class="n">queue</span><span class="o">.</span><span class="n">offer</span><span class="o">(</span><span class="n">n</span><span class="o">)){}</span>
</span><span class='line'>      <span class="o">})</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">})</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">val</span> <span class="n">consumer1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">def</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">breakable</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
</span><span class='line'>          <span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">take</span><span class="o">()</span>
</span><span class='line'>          <span class="n">print</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="n">toString</span><span class="o">()</span> <span class="o">++</span> <span class="s">&quot;,&quot;</span><span class="o">)</span>
</span><span class='line'>          <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="o">){</span>
</span><span class='line'>            <span class="n">break</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">})</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">consumer1</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'>    <span class="n">producer1</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What are we doing here ? We simply demonstrate a producer and consumer type of situation.</p>

<p>There are few things to look at, first initialization</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">val</span> <span class="n">queue</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ArrayBlockingQueue</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="mi">100</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>where we create our queue with a total capacity of 100, this can be skipped for no capacity but this could be risky in terms of memory. So we wanna omit unpredictable parts of code.</p>

<p>How to add stuff to the queue</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'>  <span class="k">while</span><span class="o">(!</span><span class="n">queue</span><span class="o">.</span><span class="n">offer</span><span class="o">(</span><span class="n">n</span><span class="o">)){}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Why like this ? lets not forget it is a blocking queue so once it will fill the capacity it will block. If the queue is full <code>offer</code> method will return false and the element will not be added tot he queue thats why we have to retry this. Of course in this case it might not be the perfect example as it will grind CPU until it can add it to the queue. So maybe adding <code>Thread.sleep(50)</code> sleep for 50 miliseconds could be good here.</p>

<p>Now lets look at consumer, here the job is simple we use take, this will simply block if we can get anything from queue and wait. In most cases this is the behavior we want. Thread simply sitting there and waiting for something to appear in the queue.</p>

<p>There is also option to use <code>add</code> function to add stuff to the queue but this will trigger an exception in case queue is full and i&rsquo;m not a big fan of handling exceptions in this type of scenarios.</p>

<p>More info about ArrayblockingQueue api can be found here <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ArrayBlockingQueue.html">http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ArrayBlockingQueue.html</a></p>

<h1>ConcurrentHashMap[K,V]</h1>

<p>Concurrent Hash Map lets you use a single dictionary / hash by many threads. This is great as it makes all the synchronization work for us. Of course often writes/updates by many threads will make it perform very very slow, but if we can eg. use it as a form of reduction result that would be great simplification.</p>

<p>If we will use it like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">java.util.concurrent._</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">Mapper</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">times</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">hash</span><span class="k">:</span> <span class="kt">ConcurrentHashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Runnable</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">run</span><span class="o">(){</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">sum</span> <span class="k">=</span> <span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="n">times</span><span class="o">).</span><span class="n">sum</span>
</span><span class='line'>    <span class="n">hash</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">hash</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">Example</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">val</span> <span class="n">resultHash</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ConcurrentHashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]()</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">threads</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span>
</span><span class='line'>      <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nc">Mapper</span><span class="o">(</span><span class="s">&quot;one&quot;</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="n">resultHash</span><span class="o">)),</span>
</span><span class='line'>      <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nc">Mapper</span><span class="o">(</span><span class="s">&quot;two&quot;</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="n">resultHash</span><span class="o">)),</span>
</span><span class='line'>      <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nc">Mapper</span><span class="o">(</span><span class="s">&quot;one&quot;</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="n">resultHash</span><span class="o">))</span>
</span><span class='line'>    <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">threads</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">start</span><span class="o">)</span>
</span><span class='line'>    <span class="n">threads</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">join</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">print</span><span class="o">(</span><span class="s">&quot;Key &#39;one&#39; =&gt; &quot;</span> <span class="o">+</span> <span class="n">resultHash</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;one&quot;</span><span class="o">).</span><span class="n">toString</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">print</span><span class="o">(</span><span class="s">&quot;Key &#39;two&#39; =&gt; &quot;</span> <span class="o">+</span> <span class="n">resultHash</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;two&quot;</span><span class="o">).</span><span class="n">toString</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course it will work but it will  often cause troubles, this code is racy :D and often it will end up with same results  for both one and two even if it is synced.  Well we now know we can use this structure from any number of threads but to make it work it would be more useful to create another thread that would be reducing values or simply have a queue where we put in partial results and a single thread that is updating the hash.  Still this can have some use, if you have a one reducer that is updating this hash or simply many different reducers updating dedicated key spaces while many other threads are simply using this hash in readonly mode. The big issue is when you want to update it as it doesn&rsquo;t support transactions and what you really want to do here is a transaction.</p>

<h1>Atomic variables</h1>

<p>Well we all love simplicity of a single variable, and in concurrent env it is simply easy to forget about goodies of sequential world and use a raw variable to store results of some execution.</p>

<p>Let us write some dodgy code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">java.util.concurrent._</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">Counter</span><span class="o">()</span> <span class="k">extends</span> <span class="nc">Runnable</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">(</span><span class="mi">1</span> <span class="n">until</span> <span class="mi">1000</span><span class="o">).</span><span class="n">map</span><span class="o">(</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">Example</span><span class="o">.</span><span class="n">counter</span> <span class="k">=</span> <span class="nc">Example</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="n">n</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">Example</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">var</span> <span class="n">counter</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">t</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nc">Counter</span><span class="o">())</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">t2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nc">Counter</span><span class="o">())</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'>    <span class="n">t2</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">join</span>
</span><span class='line'>    <span class="n">t2</span><span class="o">.</span><span class="n">join</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">print</span><span class="o">(</span><span class="n">counter</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Result should be 999000 but&hellip; you will get stuff like 907369&hellip; This happens because of both threads randomly reading and updating with garbage same val. Thats why we need atomic values :) lets convert it into less dodgy thing.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">java.util.concurrent.atomic._</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">Counter</span><span class="o">()</span> <span class="k">extends</span> <span class="nc">Runnable</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">(</span><span class="mi">1</span> <span class="n">until</span> <span class="mi">1000</span><span class="o">).</span><span class="n">map</span><span class="o">(</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="nc">Example</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">addAndGet</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">Example</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">var</span> <span class="n">counter</span><span class="k">:</span> <span class="kt">AtomicInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">t</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nc">Counter</span><span class="o">())</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">t2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nc">Counter</span><span class="o">())</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'>    <span class="n">t2</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">join</span>
</span><span class='line'>    <span class="n">t2</span><span class="o">.</span><span class="n">join</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">print</span><span class="o">(</span><span class="n">counter</span><span class="o">.</span><span class="n">get</span><span class="o">())</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After adding AtomicInteger and changing how we update to atomic updates we always get same results and it is the correct answer. It doesn&rsquo;t look good yet because of this Example.counter but that is just an example.</p>

<h1>A lot more&hellip;</h1>

<p>There is a lot more in this awesome package to cover, i will cover one more thing next time and that are Cyclic Barriers for better synchronization of threads but for now this is it :). I hope this was a useful read. I don&rsquo;t have much time to play with Scala so if something looks &ldquo;too simple&rdquo; :D yeah i&rsquo;m not a scala expert.</p>

<p>Cheers!</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/23/shortest-way-to-work-with-json-in-haskell/">Shortest Way to Work With Json in Haskell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-23T10:52:17+00:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2014</time>
        
           | <a href="/blog/2014/03/23/shortest-way-to-work-with-json-in-haskell/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2014/03/23/shortest-way-to-work-with-json-in-haskell/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><code>Data.Aeson</code> is a great package for working with json data in <code>Haskell</code> but you can make it work even in fewer lines of code.</p>

<p>if you will use <code>DeriveGeneric</code> from GHC and <code>GHC.Generics</code> in your module you can parse stuff super easy ;O.</p>

<p>This is my example that explains how to use it.</p>

<figure class='code'><figcaption><span>json_example.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="cm">{-# LANGUAGE OverloadedStrings, DeriveGeneric #-}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">import</span> <span class="nn">Data.Aeson</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">GHC.Generics</span>
</span><span class='line'>
</span><span class='line'><span class="kr">data</span> <span class="kt">Profile</span> <span class="ow">=</span> <span class="kt">Profile</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">age</span>       <span class="ow">::</span> <span class="kt">Int</span><span class="p">,</span>
</span><span class='line'>  <span class="n">isNice</span>    <span class="ow">::</span> <span class="kt">Bool</span>
</span><span class='line'><span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kr">data</span> <span class="kt">User</span> <span class="ow">=</span> <span class="kt">User</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">id</span>        <span class="ow">::</span> <span class="kt">Int</span><span class="p">,</span>
</span><span class='line'>  <span class="n">name</span>      <span class="ow">::</span> <span class="kt">String</span><span class="p">,</span>
</span><span class='line'>  <span class="n">profile</span>   <span class="ow">::</span> <span class="kt">Profile</span>
</span><span class='line'><span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="kr">instance</span> <span class="kt">FromJSON</span> <span class="kt">Profile</span>
</span><span class='line'><span class="kr">instance</span> <span class="kt">ToJSON</span> <span class="kt">Profile</span>
</span><span class='line'>
</span><span class='line'><span class="kr">instance</span> <span class="kt">FromJSON</span> <span class="kt">User</span>
</span><span class='line'><span class="kr">instance</span> <span class="kt">ToJSON</span> <span class="kt">User</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="kr">let</span> <span class="n">profile</span> <span class="ow">=</span> <span class="kt">Profile</span> <span class="mi">29</span> <span class="kt">True</span>
</span><span class='line'>  <span class="kr">let</span> <span class="n">user</span> <span class="ow">=</span> <span class="kt">User</span> <span class="mi">1</span> <span class="s">&quot;Kuba&quot;</span> <span class="n">profile</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="o">$</span> <span class="n">show</span> <span class="n">user</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">-- encode will give you back ByteString</span>
</span><span class='line'>
</span><span class='line'>  <span class="kr">let</span> <span class="n">json</span> <span class="ow">=</span> <span class="n">encode</span> <span class="n">user</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="o">$</span> <span class="n">show</span> <span class="n">json</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">-- decode will give you back Maybe</span>
</span><span class='line'>
</span><span class='line'>  <span class="kr">let</span> <span class="n">parsedUser</span> <span class="ow">=</span> <span class="n">decode</span> <span class="n">json</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">User</span>
</span><span class='line'>  <span class="kr">case</span> <span class="n">parsedUser</span> <span class="kr">of</span>
</span><span class='line'>    <span class="kt">Just</span> <span class="n">newUser</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="n">show</span> <span class="n">newUser</span>
</span><span class='line'>    <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="s">&quot;Sorry mate this is not happening&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>result</p>

<figure class='code'><figcaption><span>result</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>User <span class="o">{</span><span class="nv">id</span> <span class="o">=</span> 1, <span class="nv">name</span> <span class="o">=</span> <span class="s2">&quot;Kuba&quot;</span>, <span class="nv">profile</span> <span class="o">=</span> Profile <span class="o">{</span><span class="nv">age</span> <span class="o">=</span> 29, <span class="nv">isNice</span> <span class="o">=</span> True<span class="o">}}</span>
</span><span class='line'><span class="s2">&quot;{\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;Kuba\&quot;,\&quot;profile\&quot;:{\&quot;isNice\&quot;:true,\&quot;age\&quot;:29}}&quot;</span>
</span><span class='line'>User <span class="o">{</span><span class="nv">id</span> <span class="o">=</span> 1, <span class="nv">name</span> <span class="o">=</span> <span class="s2">&quot;Kuba&quot;</span>, <span class="nv">profile</span> <span class="o">=</span> Profile <span class="o">{</span><span class="nv">age</span> <span class="o">=</span> 29, <span class="nv">isNice</span> <span class="o">=</span> True<span class="o">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here i made shortest possible example to show off how you can work with Aeson. First of all if you will use Generics you don&rsquo;t have to write real implementation of <code>ToJSON</code> and <code>FromJSON</code> GHC will do this or you!</p>

<p>Only thing to remember is that <code>encode</code> will give you back <code>ByteString</code> and decode will give you <code>Maybe A</code> and thats it.</p>

<p>You always can fallback to normal way of describing <code>FromJSON</code> and <code>ToJSON</code> :)</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/20/versioning-of-your-code-and-api/">Versioning of Your Code and API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-20T22:20:25+00:00" pubdate data-updated="true">Mar 20<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/03/20/versioning-of-your-code-and-api/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2014/03/20/versioning-of-your-code-and-api/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>People that deal with evolving applications in &lsquo;the wild&rsquo; are often hit with quite a tricky question. How do you version your api and the code behind it?
We had similar issue where I work and i will present my idea on the topic.</p>

<h1>Motivation</h1>

<p>Different clients requests features, you upgrade your codebase and mvoe along for example streamlining api. You need a way to version the code so old clients have time to move work on upgrade and new clients can use new api without having problems.</p>

<h1>Restful API</h1>

<p>This is the first part and its easy so i will be fast on this. In my opinion using subdomains/CNAM&#8217;es for versions like</p>

<p><code>v1., v2., v3.yourdomain.com</code> or <code>20012013.yourdomain.com</code> is the best way to handle changes in API from client side. As we spoke internally using headers or any other thing can make clients go mental because they are using other type of software and
some change could be not trivial.  Yes actually people have this type of problems with very old bash/perl systems.</p>

<p>But why subdomains are cool in my opinion will unroll in next section.</p>

<h1>But what about the code ?</h1>

<p>Most important thing is how easy it will be for developer to add things without breaking other things.
Yes this is the problem! Most people will think that rolling a solution with some sort of scoping, inheritance is ok.</p>

<p>eg.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">V2</span><span class="o">::</span><span class="no">People</span>
</span><span class='line'><span class="k">class</span> <span class="nc">V1</span><span class="o">::</span><span class="no">People</span>
</span></code></pre></td></tr></table></div></figure>


<p>No its not. This is actually sh*t. Why ? Even with good code test coverage you still have issue becasue each of this class is using other classes basically sharing them. And changes in their code can affect other version of api. And with V1 and V2 it is managable but if you have 5-9 versions its starts to be crazy.</p>

<h1>How to solve it ?</h1>

<p>Imagine a queue of versions in form of deployed boxes.</p>

<p>My idea is very simple. You simply tag version codebase and deploy new version on new box while pointing new subdomain to new app.</p>

<p>What do you gain ?</p>

<ul>
<li>You are sure you can deploy from 0 your app in production in isolated environment BIG WIN</li>
<li>You know you can upgrade OS/packages in your production app with each release BIG WIN</li>
<li>You know how many people are still on some version</li>
<li>Your developer can develop in new version just like in any other app without caring for compatibility issues</li>
</ul>


<p>We live in age of cloud deploy so spinning new instance is not that expensive!</p>

<p>There is only one point you have to be very aware, that is data persistence. If you are using SQL you can only ADD COLUMNS/TABLEs never remove anything. But in most thing you will do exactly this anyway.</p>

<p>Version deploy&rsquo;s on virtual machines example:
<img src="http://i.imgur.com/9oEfbnD.png" alt="Image of V'm boxes in the web" /></p>

<h1>Ok that was fast lets recap it</h1>

<p>Process! how would you implement this in real life ? Simple!</p>

<p>When you have an app and you deploy it using eg. puppet + capistrano. When you deploy first version you make a tag in git with name eg <code>version-1</code> or <code>20032014-deploy</code> and deploy it to a box assigning a CNAME.</p>

<p>Next you start working on new version and when you will get new version you tag it <code>21032014-deploy</code> and deploy to a new box. This must contain &ldquo;build whole box script&rdquo; in puppet or if you are using docker. This way if you eg. added redis to stack you need to be sure your production deployment scripts are ready. This makes you be focused on keeping your &ldquo;production ready setup&rdquo; always up to date.</p>

<p>And after deploy you move along and work on new version. When you need to decomision old version you just kill the box. Also each version should be monitored how many requests it actually gets to the API because if you will have 20 versions up and some are getting 0 traffic you can kill them.</p>

<p>Example where many versions use same db &ldquo;ring&rdquo; / &ldquo;cluster&rdquo;:
<img src="http://i.imgur.com/Fd3OvKm.png" alt="V'ms using DB" /></p>

<h1>Rollback ?</h1>

<p>How do you rollback ? simply checkout deployment tag and deploy :)</p>

<h1>The gain ?</h1>

<p>The gain in this strategy is isolation, if you need more boxes for your main version you have ready production scripts so all you have to do is to spin them and be sure that CNAME is load balanced.</p>

<h1>Summary</h1>

<p>I don&rsquo;t think this strategy has any problem / hidden traps. You get smaller codebase to work with, ability to upgrade your production boxes and application libs/frameworks as you always move forward and deploy from scratch. You don&rsquo;t do upgrade-production box deploy but fresh deploy. Also fresh deploy can be smoke-tested by tester before putting it into production.
Deployment scripts makes you by default ready to scale your app horizontally.</p>

<p>Again What you do:</p>

<ul>
<li>start: Deploy version to a fresh box</li>
<li>Upgrade Code/OS and add features</li>
<li>Tag new version</li>
<li>goto start:</li>
</ul>


<p>IMHO everyone should move to this type of strategy in context of api versions.</p>

<p>Cheers
&ndash; Jakub Oboza</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/23/golang-new-and-make/">Golang New &amp; Make</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-23T12:42:11+00:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2014</time>
        
           | <a href="/blog/2014/02/23/golang-new-and-make/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2014/02/23/golang-new-and-make/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When i first started playing and learning Google <a href="http://golang.org/">GO</a> one if the first things i noticed was
<code>new</code> and <code>make</code>. At first glance they seemed to be doing same thing. There is a difference and it actually is quite easy to explain.</p>

<h1>Documentation</h1>

<p>If we will go to the golang doc page under <code>http://golang.org/pkg/builtin</code> we can see every builtin function in go. Also <code>new</code> and <code>make</code>. From <a href="http://golang.org/pkg/builtin/#new">new</a> we can read.</p>

<p><em>&ldquo;The new built-in function allocates memory. The first argument is a type, not a value, and the value returned is a pointer to a newly allocated zero value of that type.&rdquo;</em></p>

<p>similar on make.</p>

<p><em>&ldquo;The make built-in function allocates and initializes an object of type slice, map, or chan (only). Like new, the first argument is a type, not a value. Unlike new, make&rsquo;s return type is the same as the type of its argument, not a pointer to it.&rdquo;</em></p>

<p>So we can see that <code>new</code> return pointer to a type and make returns an allocated object of that type. Now this is a difference.</p>

<p>So how can we implement a simplified new ?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kd">func</span> <span class="nx">newInt</span><span class="p">()</span> <span class="o">*</span><span class="kt">int</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">i</span> <span class="kt">int</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">i</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">someVar</span> <span class="o">:=</span> <span class="nx">newInt</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>this is just like we would do <code>someVar := new(int)</code>.</p>

<p>In case of <code>make</code> we can only use it for <code>map</code>, <code>slice</code> and <code>chan</code>.</p>

<p><em>&ldquo;Slice: The size specifies the length. The capacity of the slice is
equal to its length. A second integer argument may be provided to
specify a different capacity; it must be no smaller than the
length, so make([]int, 0, 10) allocates a slice of length 0 and
capacity 10.
Map: An initial allocation is made according to the size but the
resulting map has length 0. The size may be omitted, in which case
a small starting size is allocated.
Channel: The channel&rsquo;s buffer is initialized with the specified
buffer capacity. If zero, or the size is omitted, the channel is
unbuffered.&rdquo;</em></p>

<p>make creates and allocates all the memory. We can specify size of the element we want in the second parameter but this only works for slice and chan. Map is a special type that doesn&rsquo;t need size.</p>

<p>And make is the only way to create this objects.</p>

<h1>Summary</h1>

<p><code>new</code> is a way of getting pointers to new types while <code>make</code> is for creating channels, maps and slices only.</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/14/dogecoin-mining-on-raspberry-pi-lolmode/">Dogecoin Mining on Raspberry Pi LOLMODE</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-14T10:43:36+00:00" pubdate data-updated="true">Jan 14<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/01/14/dogecoin-mining-on-raspberry-pi-lolmode/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2014/01/14/dogecoin-mining-on-raspberry-pi-lolmode/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>!!!UPDATE:
Download cpuminer and build from tar <a href="http://sourceforge.net/projects/cpuminer/">http://sourceforge.net/projects/cpuminer/</a> git HEAD is broken and will not let you run configure.</p>

<p>If you have <code>800 Mhash/s</code> GPU (Graphics card) i&rsquo;m sure you often think about making your raspberry pi a dogecoin miner. Because why not :D ? It is not effective i warn you :) you will get around <code>0.34 khash/s</code> that is about 2000 times less than your GPU :) and about 500 times less than CPU on your box. But its easy and fun.</p>

<p><img src="http://i.imgur.com/83LnzuU.jpg" alt="doge meme" /></p>

<p>I mainly did it for fun to see how it will react, work and what is the possible heat problem.</p>

<h1>Again Why ?</h1>

<p>Because DOGE, doge coin is THE NEW BLACK. Its future! An Irony on all crypto currency :) and its value is based on meme, laugh and happiness. This is much better than bitcoin :> at least for me</p>

<h1>Connect to your raspberry pi</h1>

<p>You will need:</p>

<figure class='code'><figcaption><span>requirements</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   automake
</span><span class='line'>   gcc
</span><span class='line'>   git-core
</span><span class='line'>   libcurl
</span></code></pre></td></tr></table></div></figure>


<p>if you are using like me <code>2014-01-07-wheezy-raspbian</code> raspbian you will have everything ready :) one thing to install is <code>automake</code> and you can do this by typing <code>apt-get update</code>  followed by <code>apt-get install automake</code> this is all you need.</p>

<p>lets get on the box! (default login/passowrd for this image is pi:raspberry)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>10:54 kuba@pc12:~  ssh pi@192.168.1.22
</span><span class='line'>pi@raspberrypi ~ <span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>(This ip address is just an example :D you will need to have a way to find it in your network.)</p>

<p>Now all you need to do is to clone CPU miner for it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/pooler/cpuminer.git
</span></code></pre></td></tr></table></div></figure>


<p>This will download your mining software on the raspeberry pi, next we need to compile it and run!</p>

<figure class='code'><figcaption><span>compiling</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pi@raspberrypi ~/Workspace <span class="nv">$ </span><span class="nb">cd </span>cpuminer-2.3.2/
</span><span class='line'>pi@raspberrypi ~/Workspace/cpuminer-2.3.2 <span class="err">$</span>
</span><span class='line'>./autogen.sh
</span><span class='line'>... script will take some <span class="nb">time</span> ...
</span><span class='line'>./configure <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-O3&quot;</span>
</span><span class='line'>make
</span></code></pre></td></tr></table></div></figure>


<p>This will compile and build the minerd binary that is ready to start mining :). Well you need to do one thing, join a doge pool. I&rsquo;m not gone go into details of solo mining vs pool minnig :)  i&rsquo;m just a simple miner :D</p>

<p>If you need more info on mining pools you should check this topic <a href="http://www.reddit.com/r/dogecoin/comments/1tn8yz/dogecoin_mining_pool_list/">http://www.reddit.com/r/dogecoin/comments/1tn8yz/dogecoin_mining_pool_list/</a></p>

<p>I personally at the time of writing this post i&rsquo;m using small pool called chunky pool :).</p>

<h2>Starting to mine!</h2>

<p>Now we have software lets actually mine something :).
You will need to create a shell script that will start minerd on your raspberry pi. My looks like this</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./minerd --a scrypt --threads 1 -o stratum+tcp://pool.chunky.ms:3333 -O dogedogedoge.pi:password
</span></code></pre></td></tr></table></div></figure>


<p>make it executable and run! Yay you are a dogecoin farmer now! CPU mining is not the most optimal but hey..its all just for lolz :)</p>

<h3>Heat problems ?</h3>

<p>For me 2 hours of mining on raspberry pi did not generate any extra heat or stuff like this, seems to be stable. I was worried it will got nuts on this topic but i was proven wrong.</p>

<h1>Summay</h1>

<p>This sucks in terms of speed, you will get close to none speed because below 2 khash/s its not even worth it, you will not be on any stats on any pool even listed, periodically you will actually hit the jackpot and get a success pimping you to 2khash/s for about 60 sec but that is  just a lie, you scored a win and this will give you some parts of doge. Last i checked you were able to get around 0.67 doge per hour of your raspberry time. That is really really bad as pretty basic GPU pimps you to 600+</p>

<p>Cheers :) Hope it helps! Much fun, so currency.</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/16/working-with-urls-quick-tip-network-dot-url/">Working With URL Quick Tip Network.Url</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-16T17:59:58+00:00" pubdate data-updated="true">Dec 16<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/12/16/working-with-urls-quick-tip-network-dot-url/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2013/12/16/working-with-urls-quick-tip-network-dot-url/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have bigger text to post but before i will do it i have to split it into smaller parts so it will not be one long post about everything.</p>

<p><img src="http://i.imgur.com/jwI5yqK.png" alt="cat explaining stuff" /></p>

<h1>Working with URL&rsquo;s</h1>

<p>Most of the time when preparing to make an http request in haskell eg. using <code>simpleHTTP</code> we need to build a request. We have several ways to do it, one of them would be to ugly glue strings together but thats not the way to do it in a safe way. Happily for us we have <code>url</code>, <code>(cabal install url)</code> package that adds <code>Network.Url</code> package. And here i will show few quick tips how to use it to work with urls.</p>

<h2>Step one: Import</h2>

<p>First thing we have to do is to import our package :D and string into our url lib.</p>

<figure class='code'><figcaption><span>start.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Network.URL</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;give me some url:&quot;</span>
</span><span class='line'>  <span class="n">rawUrl</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
</span><span class='line'>  <span class="kr">let</span> <span class="n">maybeUrl</span> <span class="ow">=</span> <span class="n">importURL</span> <span class="n">rawUrl</span> <span class="kr">in</span>
</span><span class='line'>    <span class="kr">case</span> <span class="n">maybeUrl</span> <span class="kr">of</span>
</span><span class='line'>    <span class="kt">Just</span> <span class="n">url</span> <span class="ow">-&gt;</span>
</span><span class='line'>      <span class="n">putStrLn</span> <span class="o">$</span> <span class="n">exportURL</span> <span class="o">$</span> <span class="n">add_param</span> <span class="n">url</span> <span class="p">(</span><span class="s">&quot;param_name&quot;</span><span class="p">,</span><span class="s">&quot;param_value&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="kt">Nothing</span>  <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="s">&quot;Sorry but this doesn&#39;t look like url&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the super simple example. But how it work? First of all we have <code>importURL</code> with signature:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">importURL</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">URL</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will import url in form of string to url library and give us back Maybe URL. This is awesome! So we will have type that we can work on Yay! To exit library and get back string. We need to use <code>exportURL</code> with signature:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">exportURL</span> <span class="ow">::</span> <span class="kt">URL</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
</span></code></pre></td></tr></table></div></figure>


<p>So we are only doing some simple transformation <code>String ~&gt;~ Maybe URL ~&gt;~ URL ~&gt;~ String</code> thats nothing we can&rsquo;t handle!</p>

<p>Next important bit is <code>add_param</code> function with signature:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">add_param</span> <span class="ow">::</span> <span class="kt">URL</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">URL</span>
</span></code></pre></td></tr></table></div></figure>


<p>This does exactly what we would expect :D If we need to add to url <code>http://google.com</code> two params <code>ok=1</code> and <code>query=haskell</code> To build  <code>http://google.com?query=haskell&amp;ok=1</code>.</p>

<h2>Step two: More detailed example</h2>

<p>I will try to reiterate our first example showing a bit more thing. Or just same things in a different way. Lets try to add two params.</p>

<figure class='code'><figcaption><span>ue2.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Network.URL</span>
</span><span class='line'>
</span><span class='line'><span class="nf">prepareUrl</span> <span class="n">url</span> <span class="ow">=</span>
</span><span class='line'>  <span class="kr">let</span> <span class="n">newUrl</span> <span class="ow">=</span> <span class="n">add_param</span> <span class="n">url</span> <span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="s">&quot;gimme cats pics&quot;</span><span class="p">)</span> <span class="kr">in</span>
</span><span class='line'>    <span class="n">add_param</span> <span class="n">newUrl</span> <span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span> <span class="s">&quot;any&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;give me some url:&quot;</span>
</span><span class='line'>  <span class="n">rawUrl</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
</span><span class='line'>  <span class="kr">let</span> <span class="n">maybeUrl</span> <span class="ow">=</span> <span class="n">importURL</span> <span class="n">rawUrl</span> <span class="kr">in</span>
</span><span class='line'>    <span class="kr">case</span> <span class="n">maybeUrl</span> <span class="kr">of</span>
</span><span class='line'>    <span class="kt">Just</span> <span class="n">url</span> <span class="ow">-&gt;</span>
</span><span class='line'>      <span class="n">putStrLn</span> <span class="o">$</span> <span class="n">exportURL</span> <span class="o">$</span> <span class="n">prepareUrl</span> <span class="n">url</span>
</span><span class='line'>    <span class="kt">Nothing</span>  <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="s">&quot;Sorry but this doesn&#39;t look like url&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should run the code and see something like this:</p>

<figure class='code'><figcaption><span>ue2.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'> <span class="err"></span> <span class="o">./</span><span class="n">ue2</span>
</span><span class='line'><span class="nf">give</span> <span class="n">me</span> <span class="n">some</span> <span class="n">url</span><span class="kt">:</span>
</span><span class='line'><span class="nf">lambdacu</span><span class="o">.</span><span class="n">be</span>
</span><span class='line'><span class="nf">lambdacu</span><span class="o">.</span><span class="n">be</span><span class="o">?</span><span class="n">size</span><span class="ow">=</span><span class="n">any</span><span class="o">&amp;</span><span class="n">query</span><span class="ow">=</span><span class="n">gimme</span><span class="o">+</span><span class="n">cats</span><span class="o">+</span><span class="n">pics</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Summary</h1>

<p>It is just a quick tip :) <code>Network.URL</code> has few more functions eg. to check if protocol is secure and checking if params are ok.
But stuff showed above is the main point of lib.</p>

<p>More about this lib ofc on hackage: <a href="http://hackage.haskell.org/package/url-2.1/docs/Network-URL.html">http://hackage.haskell.org/package/url-2.1/docs/Network-URL.html</a></p>

<p>&hellip;.And quick tip should be quick :)</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/12/forkio-and-friends/">forkIO and Friends</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-12T17:38:53+00:00" pubdate data-updated="true">Dec 12<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/12/12/forkio-and-friends/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2013/12/12/forkio-and-friends/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post is sponsored by <code>forkIO</code> function and <code>newChan</code> in <code>Haskell</code></p>

<p><img src="http://i.imgur.com/5yQNQxs.png" alt="Catz" /></p>

<h1>What is this forkIO ?</h1>

<p>forkIO is part of <code>Control.Concurrent</code> package and as it says it:</p>

<blockquote><p>Sparks off a new thread to run the IO computation passed as the first argument, and returns the ThreadId of the newly created thread.
The new thread will be a lightweight thread; if you want to use a foreign library that uses thread-local storage, use forkOS instead.</p></blockquote>

<p>This is very neat if your program wants to use all the cores of your CPU or at least be more responsive not waiting for stuff to happen.</p>

<p>forkIO type is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">forkIO</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">ThreadId</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Channels to help !</h1>

<p>forkIO would be enough to start working on stuff but to make a real use of them we need a way of communicating with our threads. This actually opens design of our code to new stuff like building workers. There are other ways of communicating with threads like mVar but IMHO channels win hard.</p>

<p>Channels are part of <code>Control.Concurrent.Chan</code> package and are typable! Typed communication Yay!</p>

<p>Channels functions we need have the following type signatures:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">newChan</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">Chan</span> <span class="n">a</span><span class="p">)</span>
</span><span class='line'><span class="nf">writeChan</span> <span class="ow">::</span> <span class="kt">Chan</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
</span><span class='line'><span class="nf">readChan</span> <span class="ow">::</span> <span class="kt">Chan</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="n">a</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s actually all we need. Let&rsquo;s make some stuff working.</p>

<h1>Ok So lets get this party started :)</h1>

<p>I think most of the time it&rsquo;s better to explain stuff on examples.</p>

<h2>Just spawn!</h2>

<p>First thing we want is just to spawn!</p>

<figure class='code'><figcaption><span>just_spawn.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>    <span class="n">putStrLn</span> <span class="s">&quot;Yay! i&#39;m in thread!&quot;</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;I&#39;m important i&#39;m in Main thread!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a very simple way to spawn a light weight thread via forkIO :>. As you can see it is a normal action so you can go dirty!</p>

<p>forkIO takes actions and give you back IO ThreadId so you can keep track / kill threads you don&rsquo;t like</p>

<h2>Just Spawn</h2>

<p>Previous example was a bit cheating as it showed nothing really important so lets make some crazy threads printing stuff now.</p>

<figure class='code'><figcaption><span>crazygals.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent</span>
</span><span class='line'>
</span><span class='line'><span class="nf">fanOfGarbage</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Garbage is best bad evar!&quot;</span>
</span><span class='line'>  <span class="n">fanOfGarbage</span>
</span><span class='line'>
</span><span class='line'><span class="nf">fanOfClassicMusic</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Dude Garbage is garbage&quot;</span>
</span><span class='line'>  <span class="n">fanOfClassicMusic</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;hit it guys!&quot;</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="n">fanOfGarbage</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="n">fanOfClassicMusic</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well compiling and running this gives you only &ldquo;hit it guys&rdquo; as main thread exits and child threads dies! lets fix it so we can say when they need to stop!:></p>

<figure class='code'><figcaption><span>crazygals2.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent</span>
</span><span class='line'>
</span><span class='line'><span class="nf">fanOfGarbage</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Garbage is best bad evar!&quot;</span>
</span><span class='line'>  <span class="n">fanOfGarbage</span>
</span><span class='line'>
</span><span class='line'><span class="nf">fanOfClassicMusic</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Dude Garbage is garbage&quot;</span>
</span><span class='line'>  <span class="n">fanOfClassicMusic</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;hit it guys!&quot;</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="n">fanOfGarbage</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="n">fanOfClassicMusic</span>
</span><span class='line'>  <span class="n">getLine</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Thank You Sir for stopping them!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After launching it you can see how each thread is spamming its prints ;> So it work until you will hit enter. Cool so we have something working.</p>

<p>How does it work ? first of all we use forkIO to spawn threads and this time we have each &ldquo;thread&rdquo; function in separation.
Each of them run forever like crazy music fans :). In this place we can make it simple by using <code>forever</code> from <code>Control.Monad</code> to make it simpler.</p>

<figure class='code'><figcaption><span>crazygals3.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">forever</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nf">fanOfGarbage</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">forever</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>    <span class="n">putStrLn</span> <span class="s">&quot;Garbage is best bad evar!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">fanOfClassicMusic</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">forever</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>    <span class="n">putStrLn</span> <span class="s">&quot;Dude Garbage is garbage&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;hit it guys!&quot;</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="n">fanOfGarbage</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="n">fanOfClassicMusic</span>
</span><span class='line'>  <span class="n">getLine</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Thank You Sir for stopping them!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>forever</code> is part of <code>Control.Monad</code> as name says it is doing action forever ;) useful for stuff like workers or stuff that has to happen all the time it type is <code>forever :: Monad m =&gt; m a -&gt; m b</code>.</p>

<h2>Something useful, add channels</h2>

<p>Cool so now we have some basics how to spawn a thread using forkIO but to have something that we actually can use in real life we need to have some sort of communication. I wanna present something i feel would be useful in almost every haskell program. Channel combined with forkIO.</p>

<p>If you programmed ever in <code>Erlang</code> or <code>Go</code> you will know what i&rsquo;m talking about, channels are very similar to message passing. Basically it is a pipe that you can write to or read from in different threads/processes. This is one of the mechanism we can use to get data out of other threads. Because they are not sequential we can&rsquo;t predict normal vals  or time when they will be ready. One of the ways of getting response from threads are channels.</p>

<p>Channels are amazing because they are flexible :) And very natural. Basic principle is simple you write in one thread to the channel and read in other :)</p>

<p>But lets make an example that will show how powerful it is.</p>

<figure class='code'><figcaption><span>chanz.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">forever</span><span class="p">)</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent.Chan</span>
</span><span class='line'>
</span><span class='line'><span class="nf">gossipGirl</span> <span class="n">chan</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">forever</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>    <span class="n">gossip</span> <span class="ow">&lt;-</span> <span class="n">readChan</span> <span class="n">chan</span>
</span><span class='line'>    <span class="n">putStrLn</span> <span class="n">gossip</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Lets do some gossips&quot;</span>
</span><span class='line'>  <span class="n">gossipChan</span> <span class="ow">&lt;-</span> <span class="n">newChan</span> <span class="c1">-- lets make new chan</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="o">$</span> <span class="n">gossipGirl</span> <span class="n">gossipChan</span> <span class="c1">-- spawn gossipGirl</span>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">gossipChan</span> <span class="s">&quot;Garbage is garbage!&quot;</span>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">gossipChan</span> <span class="s">&quot;Garbage is garbage for reals!&quot;</span>
</span><span class='line'>  <span class="n">getLine</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Thank You Sir for Info&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nice! What happens here :)  So new things are <code>newChan</code> that create channel which we will use to talk to our gossipGirl. <code>readChan</code> reads data from channel and <code>writeChan</code> writes stuff to channel. This is very simple :) So now lets generalize our worker into something that we can use in next mini tutorials. A worker.</p>

<h2>A Worker</h2>

<p>simple worker will take 1 channel as parameter and spawn thread this will help us in understanding how this whole thing works. (ofc if we don&rsquo;t got it by now :) )</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">forever</span><span class="p">)</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent.Chan</span>
</span><span class='line'>
</span><span class='line'><span class="nf">worker</span> <span class="n">chan</span> <span class="n">foo</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="o">$</span> <span class="n">forever</span> <span class="o">$</span> <span class="n">foo</span> <span class="n">chan</span>
</span><span class='line'>
</span><span class='line'><span class="nf">worker2</span> <span class="n">action</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="o">$</span> <span class="n">forever</span> <span class="n">action</span>
</span><span class='line'>
</span><span class='line'><span class="nf">gossipGirl</span> <span class="n">chan</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>    <span class="n">gossip</span> <span class="ow">&lt;-</span> <span class="n">readChan</span> <span class="n">chan</span>
</span><span class='line'>    <span class="n">putStrLn</span> <span class="n">gossip</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Lets do some gossips&quot;</span>
</span><span class='line'>  <span class="n">gossipChan</span> <span class="ow">&lt;-</span> <span class="n">newChan</span> <span class="c1">-- lets make new chan</span>
</span><span class='line'>  <span class="n">gossipChan2</span> <span class="ow">&lt;-</span> <span class="n">newChan</span> <span class="c1">-- lets make new chan</span>
</span><span class='line'>  <span class="n">worker</span> <span class="n">gossipChan</span> <span class="n">gossipGirl</span> <span class="c1">-- spawn gossipGirl</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">gossipChan</span> <span class="s">&quot;Garbage is garbage!&quot;</span>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">gossipChan</span> <span class="s">&quot;Garbage is garbage for reals!&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">worker2</span> <span class="p">(</span><span class="n">gossipGirl</span> <span class="n">gossipChan2</span><span class="p">)</span> <span class="c1">-- woker2 2 girl!</span>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">gossipChan2</span> <span class="s">&quot;Umkay&quot;</span>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">gossipChan2</span> <span class="s">&quot;Yez!&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">getLine</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Thank You Sir for Info&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yes you can build workers as you want. I would not spend time on trying to build uber generic worker as it is usually custom and you don&rsquo;t need to spend much time to make one :). Usually you can have worker types for particular tasks eg. databasesWriter, logWriters, counters etc.</p>

<p>Now why would you all this forkIO stuff ? here is there reason. Cat simulation!</p>

<figure class='code'><figcaption><span>cat.hs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">forever</span><span class="p">)</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Concurrent.Chan</span>
</span><span class='line'>
</span><span class='line'><span class="kr">data</span> <span class="kt">AskForMeow</span> <span class="ow">=</span> <span class="kt">GibFood</span> <span class="o">|</span> <span class="kt">Smile</span>
</span><span class='line'>
</span><span class='line'><span class="nf">meowMe</span> <span class="n">chan</span> <span class="n">chanBack</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">niceTry</span> <span class="ow">&lt;-</span> <span class="n">readChan</span> <span class="n">chan</span>
</span><span class='line'>  <span class="kr">case</span> <span class="n">niceTry</span> <span class="kr">of</span>
</span><span class='line'>    <span class="kt">GibFood</span> <span class="ow">-&gt;</span> <span class="n">writeChan</span> <span class="n">chanBack</span> <span class="s">&quot;Meow&quot;</span>
</span><span class='line'>    <span class="kt">Smile</span>   <span class="ow">-&gt;</span> <span class="n">writeChan</span> <span class="n">chanBack</span> <span class="s">&quot;No&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">cat</span> <span class="n">action</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">forkIO</span> <span class="o">$</span> <span class="n">forever</span> <span class="n">action</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="s">&quot;Hey kitty kitty&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">foodInputChan</span> <span class="ow">&lt;-</span> <span class="n">newChan</span>
</span><span class='line'>  <span class="n">catOutputChan</span> <span class="ow">&lt;-</span> <span class="n">newChan</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">cat</span> <span class="o">$</span> <span class="n">meowMe</span> <span class="n">foodInputChan</span> <span class="n">catOutputChan</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">foodInputChan</span> <span class="kt">Smile</span>
</span><span class='line'>  <span class="n">response</span> <span class="ow">&lt;-</span> <span class="n">readChan</span> <span class="n">catOutputChan</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="n">response</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">writeChan</span> <span class="n">foodInputChan</span> <span class="kt">GibFood</span>
</span><span class='line'>  <span class="n">response&#39;</span> <span class="ow">&lt;-</span> <span class="n">readChan</span> <span class="n">catOutputChan</span>
</span><span class='line'>  <span class="n">putStrLn</span> <span class="n">response&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">getLine</span>
</span><span class='line'>  <span class="n">return</span> <span class="nb">()</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Summary</h1>

<p>I hope this gives a little insight into <code>forkIO</code> and <code>channels</code> functions as You should use them in your code. It is super simple to add them, they work miracles and i love them. Yes you don&rsquo;t need to be expert on Kleisli arrows to use them ;).</p>

<p>Cheers!</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/21/erlang-e17-and-second-edition-of-programming-erlang/">Erlang E17 and Second Edition of Programming Erlang</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-21T20:09:00+01:00" pubdate data-updated="true">Oct 21<span>st</span>, 2013</time>
        
           | <a href="/blog/2013/10/21/erlang-e17-and-second-edition-of-programming-erlang/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2013/10/21/erlang-e17-and-second-edition-of-programming-erlang/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I got my hands on <a href="http://pragprog.com/book/jaerlang2/programming-erlang">Programming Erlang 2ed</a>. And i have to make a spoiler now. The book is great. I remember the times when i was reading &ldquo;Programing Erlang&rdquo; and it was a great book. I enjoyed it and it made me get into erlang I was a really happy person.</p>

<p>This book is talking about R17. From what i read R17 should be named Erlang 2.0 the changes are just amazing.</p>

<p>My face after reading changes&hellip;</p>

<p><img src="http://i.imgur.com/fbC4hQ7.png" alt="Vomiting Rainbow" /></p>

<h1>Page 75 Maps</h1>

<p>This chapter hits you in the face! I don&rsquo;t have yet E17 to check more stuff but this looks amazing. Ok lets have a look. In Erlang E17 they are introducing MAPS. Also known as key-val&rsquo;s / hashes / assoccs / dictionary. Basically a data structure that lets you store a value with a key and retrieve the value if you know the right key.</p>

<p>Lets have a look at the syntax.</p>

<figure class='code'><figcaption><span>maps</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="err"></span>  <span class="nv">Kv</span> <span class="o">=</span> <span class="err">#</span><span class="p">{</span><span class="n">a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>This creates a map with 3 elements a,b and c. Easy. Of course maps are immutable data structures so if you want to add stuff you need to do it like this</p>

<figure class='code'><figcaption><span>maps2</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="err"></span>  <span class="nv">Kv2</span> <span class="o">=</span> <span class="nv">Kv</span><span class="err">#</span><span class="p">{</span><span class="n">d</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>So it is similar to updating records but imho the true power is in retrieving data and pattern matching on maps. YES PATTERN MATCHING.</p>

<figure class='code'><figcaption><span>maps3</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="err"></span>  <span class="err">#</span><span class="p">{</span><span class="n">b</span> <span class="o">=&gt;</span> <span class="nv">B</span><span class="p">,</span> <span class="n">c</span> <span class="o">=&gt;</span> <span class="nv">C</span><span class="p">}</span> <span class="o">=</span> <span class="nv">Kv2</span><span class="p">.</span>
</span><span class='line'><span class="err"></span>  <span class="nv">B</span><span class="p">.</span>
</span><span class='line'><span class="err"></span><span class="o">&gt;</span> <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>Isn&rsquo;t this amazing!? You can use maps like in ruby and pattern match on them. And i was just about to scream from joy when&hellip;</p>

<p>i saw this.</p>

<h2>Maps &ndash;>  Json</h2>

<p>Yes you can serialize and deserialize maps to json. WTF ?! Yes.</p>

<figure class='code'><figcaption><span>maps4</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="err"></span> <span class="nn">maps</span><span class="p">:</span><span class="n">to_json</span><span class="p">(</span><span class="nv">Map</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">Bin</span>
</span></code></pre></td></tr></table></div></figure>


<p>Calling maps:to_json you can make from map a json and by calling</p>

<figure class='code'><figcaption><span>maps5</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="err"></span> <span class="nn">maps</span><span class="p">:</span><span class="n">from_json</span><span class="p">(</span><span class="nv">Bin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">Map</span>
</span><span class='line'><span class="err"></span> <span class="nn">maps</span><span class="p">:</span><span class="n">save_from_json</span><span class="p">(</span><span class="nv">Bin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nv">Map</span>
</span></code></pre></td></tr></table></div></figure>


<p>Gives you option to load maps from binaries! C&#8217;mon! this is amazing. Safe version will explode if you try to flood VM with not existing atoms. This is useful! because atoms are never GC&#8217;ed!</p>

<p>Yes new MAPs are amazing! I love them :> This sloves so many problems and resolved so many situations when you had to write boilerplate code. Amazing work!</p>

<h1>Page 287 Programing with Websockets and Erlang</h1>

<p>Is also new thing i love this chapter as it shows you how to tackle real thing which is websockets :) it is very cool addition to the book and also a free sample so you can read it on your own before buying book.</p>

<p><a href="http://media.pragprog.com/titles/jaerlang2/websockets.pdf">http://media.pragprog.com/titles/jaerlang2/websockets.pdf</a></p>

<h1>Addition of Dializer and Rebar</h1>

<p>This is great from empiric point of view as Joe shows how to use rebar and build real life code using github. This is a great thing and worth reading. I love it :) You get real life example&hellip; i get here everything i lacked in previous book.</p>

<h1>Summary</h1>

<p>Every single new thing in the book is great. Stuff about E17 version of Erlang is just great. I don&rsquo;t have E17 yet on my box but this will be by far best release of Erlang.  In chapter about maps he talks about looking at ruby. I think it is a bit inspired by ruby builtin syntax for hashes by yet again. This is amazing and in future this will resolve so many problems and make many API&rsquo;s much more useful. You don&rsquo;t have to type anymore ton of _ if you want to pattern match on big tuple. You can match on a key.</p>

<p>I spend an hour reading the book on the train from London to Epsom and all I can say. It is great!. I love it and i love new changes!</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/02/redis-setex-to-the-rescue/">Redis SETEX to the Rescue</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-02T23:33:00+01:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2013</time>
        
           | <a href="/blog/2013/07/02/redis-setex-to-the-rescue/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2013/07/02/redis-setex-to-the-rescue/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is next mini entry about small thing that makes me happy in terms of changes in redis. Nothing new :D but still nice :D.</p>

<h1>SET, EXPIRE, CHECK, ???, REPEAT</h1>

<p>While using redis there is very common task we do. It is <code>SET</code> followed by <code>EXPIRE</code>. We do this when we want to cache for some period of time some data.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>SET <span class="s2">&quot;user:1:token&quot;</span> <span class="s2">&quot;kuba&quot;</span>
</span><span class='line'>EXPIRE <span class="s2">&quot;user:1:token&quot;</span> 5
</span></code></pre></td></tr></table></div></figure>


<p>This will set key <code>user:1:token</code> to value <code>"kuba"</code> and next set it to expire in 5 seconds. We can check Time to live on this key by using ttl command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>TTL <span class="s2">&quot;user:1:token&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>this will return number of seconds that this key will be valid for or an negative number if its not valid anymore.</p>

<h1>SETEX</h1>

<p>SETEX Introduced in redis 2.0.0 command, lets you do both things SET and EXPIRE in one go. How do we use it ? Its simple!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>SETEX &lt;key&gt; &lt;seconds&gt; &lt;value&gt;
</span></code></pre></td></tr></table></div></figure>


<p>It is not key, value seconds! :D:D example usage:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>SETEX <span class="s2">&quot;key:to:home&quot;</span> 1500 <span class="s2">&quot;4b234ferg34ret34rasd32rs&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will set for 1500 seconds key &ldquo;key:to:home&rdquo; to value &ldquo;4b234ferg34ret34rasd32rs&rdquo;. Pretty easy thing to do.</p>

<h2>PSETEX</h2>

<p>Since Redis 2.6.0 we can use new command it is PSETEX <key> <milliseconds> <value> this is same as SETEX except it takes miliseconds not seconds so you can be more accurate in low latency / time situations</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>PSETEX <span class="s2">&quot;key:to:home&quot;</span> 15000 <span class="s2">&quot;4b234ferg34ret34rasd32rs&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Will set &ldquo;key:to:home&rdquo; to expire in 15 seconds, its important to notice that TTL will give you back amount of time units! so if you did PSETEX it will me miliseconds and if it is SETEX it is in seconds!.</p>

<p>Cheers!</p>
</div>
  
  



    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/09/how-to-use-twitter-for-something-else-than-pics-of-cats/">How to Use Twitter for Something Else Than Pics of Cats</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-09T23:30:00+01:00" pubdate data-updated="true">Jun 9<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/06/09/how-to-use-twitter-for-something-else-than-pics-of-cats/#disqus_thread"
             data-disqus-identifier="http://no-fucking-idea.com/blog/2013/06/09/how-to-use-twitter-for-something-else-than-pics-of-cats/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So it was long since last post and i have in pipeline many posts on ODM&rsquo;s, Genetic Algorithms, Streaming Algorithms Clojure and Haskell i was working on but nothing is finished ;/. Need time!</p>

<h1>I&rsquo;m using twitter</h1>

<p>And most of the time it is just updates from friends, sometimes some news from hacker world that potentially could be interesting. I use twitter in a bit odd way first of all i post link to things i read during commute to work :) and i use twitter to post alters from my apps to me.</p>

<h1>Why twitter ?</h1>

<p>I think twitter is great because he is posting things to my phone also, so instead of building this really complex infrastructure i can use twitter to do everything.</p>

<h1>How ?</h1>

<p>This is simple i add to every app i make a bit of code to handle twitter. eg. method like this in ruby</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">alert_notify!</span>
</span><span class='line'>  <span class="k">if</span> <span class="vi">@config</span><span class="o">[</span><span class="ss">:notification_list</span><span class="o">]</span>
</span><span class='line'>    <span class="n">notifier</span> <span class="o">=</span> <span class="no">Twitter</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span class='line'>      <span class="ss">:oauth_token</span> <span class="o">=&gt;</span> <span class="vi">@config</span><span class="o">[</span><span class="ss">:&quot;oauth_token&quot;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:oauth_token_secret</span> <span class="o">=&gt;</span> <span class="vi">@config</span><span class="o">[</span><span class="ss">:&quot;oauth_token_secret&quot;</span><span class="o">]</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="vi">@config</span><span class="o">[</span><span class="ss">:notification_list</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
</span><span class='line'>      <span class="n">notifier</span><span class="o">.</span><span class="n">direct_message_create</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">: I crushed! please go to logs and see what happpened!&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is part of TwitterDriver/Agent class. And i wrap everything into exception handler when i get exception i log it and send notification to me via twitter direct message.</p>

<p>I love this way of using twitter because a year ago i thought it is only for sharing very random not useful messages about cats and sharing instagram pictures.</p>

<p>Try it yourself!</p>
</div>
  
  



    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/08/25/java-dot-util-dot-concurrent-goodies/">java.util.concurrent Goodies</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/23/shortest-way-to-work-with-json-in-haskell/">Shortest Way to Work With Json in Haskell</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/20/versioning-of-your-code-and-api/">Versioning of Your Code and API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/23/golang-new-and-make/">Golang New &amp; Make</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/14/dogecoin-mining-on-raspberry-pi-lolmode/">Dogecoin Mining on Raspberry Pi LOLMODE</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/JakubOboza">@JakubOboza</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'JakubOboza',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101398174644580064637?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Jakub Oboza -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nofuckingidea';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
